It is possible to go to the **Example** tab in **Fit** and choose between different drug-patient characteristics. This dataset comes from ["Intra-tumour diversification in colorectal cancer at the single-cell level"](https://www.nature.com/articles/s41586-018-0024-3).

Once the drug-response data is uploaded or the selected drug-patient characterics are selected, click the `Plot` button to compile the graph. 

### 2. Plot options

Once the plot is generated, in the **Options** tab we can select from the following: 

- Plot Overlays
  - **Point samples:** If dataset consists of multiple samples, this are shown in plot
  - **ENDS:** The ENDS fit is shown, it is a spline connecting the means of the samples of the data.
  - **Min-max bands:** Connects the maximum and minimum of the samples.
  - **Empirical variability bands:** A non-parametric variability band is generated by connecting the sides of the step function generted by the adjacent mean lines, namely the mean of each consecuentent pair of responses. It can be used to visualize the variability of the samples within this bands. 
  - **Drug span gradient:** It is the linear regression fit of the mean responses,  the gradient angle is given in the plot.
  - **Relative doses:** The angle of each of the spline fits is given such that the most effective dose, would be the one to have the steepest gradient. We can aslo compare each individual gradient with the *drug span gradient* to see if each dose is more effective than the overall trend, if it is more steep then we say it is a *Possitive Relative Dose* (PRD) otherwise it is a *Negative Relative Dose*. The Concave Ratio (CR) is defined $CR=\frac{\#PRD}{\#NRD}$.
  - **Relative doses 2:** The Concave Ratio is calculated differently, it is the difference between the integral of the ENDS fit and the spline fit. If the $CR>0$ then we expect the function to be concave, and if $CR<0$ then convex.
  
- **Logistic fit:** This is the usual four parameter logistic fit to the data by mean square errror. Using the equation $$f(x) = c + \frac{d-c}{1+\exp{b(\log x - \log e)}} $$​ The $IC_{50}$ and squared errors of the fit are shown on the plot.

- **Monotone fit:** This alternative nonparametric spline imposes a monotone decreasing constrain. If the spline between two doses does not have a negative slope, then the average of the previous doses is recursively calculated until the next spline has a negative slope, which connects the average with the next data point. The $IC_{50}$​ and squared errors of the fit are shown on the plot. This was inspired by the paper ["Monotonic Nonparametric Dose Response Model"](https://arxiv.org/abs/1910.00150).

- **Nonparametric bayesian fit:** Given points $(x_i, y_i)_{i=1}^N$, with knots $K=\{k_i\}_{i=1}^J$ and parameter $\lambda>0$ we will model the relation $f(x) = C + (1-C)\sum_{j=1}^J a_j (1-F(x|k_j,\lambda))$ with the bayesian hierarchical model
$$C \sim \textrm{Beta}(1,1)$$
$$a \sim \textrm{Dir}(\alpha_1,..,\alpha_J)$$
$$\sigma^2 \sim \chi^2(2 ) $$
$$y|C,a,|sigma^2 \sim N(f(x), \sigma^2)$$
  Weights follow the restrictions $a_i\geq 0$ and $\sum_i a_i=1$.
  We can use MCMC to sample from the posterior distribution, $p(C,a,\sigma^2|y,x,K,\lambda) \propto p(a)p( C )p(\sigma^2)p(y|x,a,C,\sigma^2,K,\lambda)$ in this case an inhouse MH sampling is used for posterior inference. Knots are chosen on the doses and $\lambda$ is chosen over a grid of values including the mean variance estimate of the samples at each knot. We also chose a uniform dirichlet distribution as prior for $a$, slightly different model choice from ["A Bayesian Monotonic Non-parametric Dose-Response Model"](https://www.tandfonline.com/doi/abs/10.1080/10807039.2021.1956298).

### 3. Download

The plots generated can be downloaded in the **Plot** tab.

- The name can be specified or the default name is `ENDS`
- The dots per inch are applicable only to "png" of "jpeg" downloads.

